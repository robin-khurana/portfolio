<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robin Khurana | Portfolio</title>
    <meta name="description" content="Personal homepage of Robin Khurana.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="background-blobs">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <main class="container">
        <header class="header">
            <h1 class="logo">RK.</h1>
            <nav class="nav">
                <a href="#" class="nav-link active">Home</a>
                <a href="#" class="nav-link">About</a>
                <a href="#" class="nav-link">Contact</a>
            </nav>
        </header>

        <section class="hero">
            <div class="hero-content">
                <h1 class="name">Robin Khurana Progress</h1>
            </div>
        </section>

        <section class="market-overview" style="padding: 2rem 0;">
            <h3 class="section-title">Market Overview</h3>
            <div class="tradingview-widget-container">
                <div class="tradingview-widget-container__widget"></div>
                <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
                    {
                        "symbols": [
                            { "proName": "NASDAQ:GOOGL", "title": "Google" },
                            { "proName": "NASDAQ:AAPL", "title": "Apple" },
                            { "proName": "NASDAQ:MSFT", "title": "Microsoft" },
                            { "proName": "NASDAQ:AMZN", "title": "Amazon" },
                            { "proName": "NASDAQ:META", "title": "Meta" },
                            { "proName": "NSE:ASIANPAINT", "title": "Asian Paints" },
                            { "proName": "NSE:AXISBANK", "title": "Axis Bank" }
                        ],
                        "showSymbolLogo": true,
                        "colorTheme": "dark",
                        "isTransparent": true,
                        "displayMode": "adaptive",
                        "locale": "en_IN",
                        "timezone": "Asia/Kolkata"
                    }
                </script>
            </div>
        </section>

        <section class="daily-goals">
            <h3 class="section-title">Daily Goals</h3>
            <div class="goals-container">
                <div class="goal-input-group">
                    <input type="text" id="daily-goal-input" placeholder="Today's focus..." autocomplete="off">
                    <button id="add-daily-goal-btn" aria-label="Add daily goal">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </div>
                <ul id="daily-goals-list" class="goals-list"></ul>
            </div>
        </section>

        <section class="news">
            <h3 class="section-title">Long Term Goals</h3>
            <div class="goals-container">
                <div class="goal-input-group">
                    <input type="text" id="goal-input" placeholder="Enter a new long term goal..." autocomplete="off">
                    <button id="add-goal-btn" aria-label="Add goal">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </div>
                <ul id="goals-list" class="goals-list"></ul>
            </div>
        </section>

        <section class="news">
            <h3 class="section-title">News Today</h3>
            <div class="news-container">
                <div class="news-category"><span class="category-label world">World</span><div class="ticker-wrap"><div class="ticker" id="ticker-world"></div></div></div>
                <div class="news-category"><span class="category-label business">Business</span><div class="ticker-wrap"><div class="ticker" id="ticker-business"></div></div></div>
                <div class="news-category"><span class="category-label sports">Cricket</span><div class="ticker-wrap"><div class="ticker" id="ticker-cricket"></div></div></div>
                <div class="news-category"><span class="category-label bollywood">Bollywood</span><div class="ticker-wrap"><div class="ticker" id="ticker-bollywood"></div></div></div>
                <div class="news-category"><span class="category-label entertainment">Entertainment</span><div class="ticker-wrap"><div class="ticker" id="ticker-entertainment"></div></div></div>
                <div class="news-category"><span class="category-label national">National</span><div class="ticker-wrap"><div class="ticker" id="ticker-national"></div></div></div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p>&copy; 2025 Robin Khurana. All rights reserved.</p>
    </footer>

    <script>
        // --- CONFIGURATION ---
        const API_BASE = 'https://robbie57.pythonanywhere.com/api';
        const rss2json = "https://api.rss2json.com/v1/api.json?rss_url=";

        // --- NEWS LOGIC ---
        const channels = {
            world: "UC16niRr50-MSBwiO3YDb3RA", 
            business: "UCvJJ_dzjViJCoLf5uKUTwoA", 
            cricket: "https://timesofindia.indiatimes.com/rssfeeds/54829575.cms",
            entertainment: "UCdtXPiqI2cLorKaPrfpKc4g",
            national: "UCYPvAwZP8pZhSMW8qs7cVCw",
            bollywood: "https://timesofindia.indiatimes.com/rssfeeds/1081479906.cms"
        };

        Object.entries(channels).forEach(([key, value]) => {
            const targetUrl = value.length === 24 ? `https://www.youtube.com/feeds/videos.xml?channel_id=${value}` : value;
            fetch(`${rss2json}${encodeURIComponent(targetUrl)}`)
                .then(res => res.json())
                .then(data => {
                    const el = document.getElementById(`ticker-${key}`);
                    if (data.status === 'ok') {
                        const content = data.items.map(i => `<a href="${i.link}" target="_blank" class="news-item link">${i.title}</a>`).join(' | ');
                        el.innerHTML = content + " | " + content;
                    }
                }).catch(() => {});
        });

        // --- BACKEND API FUNCTIONS ---
        async function apiCall(endpoint, method = 'GET', body = null) {
            const options = { method, headers: { 'Content-Type': 'application/json' } };
            if (body) options.body = JSON.stringify(body);
            try {
                const res = await fetch(`${API_BASE}${endpoint}`, options);
                return res.ok ? await res.json() : null;
            } catch (e) { console.error(e); return null; }
        }

        // --- GOAL ACTIONS ---
        window.handleToggle = async (id, currentStatus, type) => {
            await apiCall(`/goals/${id}`, 'PUT', { completed: !currentStatus });
            render(type);
        };

        window.handleDelete = async (id, type) => {
            await apiCall(`/goals/${id}`, 'DELETE');
            render(type);
        };

        async function addGoal(inputId, type) {
            const input = document.getElementById(inputId);
            const text = input.value.trim();
            if (text) {
                await apiCall('/goals', 'POST', { text, type });
                input.value = '';
                render(type);
            }
        }

        // --- RENDERING ---
        async function render(type) {
            const goals = await apiCall(`/goals?type=${type}`);
            const list = document.getElementById(type === 'daily' ? 'daily-goals-list' : 'goals-list');
            if (!goals) return;
            
            list.innerHTML = goals.map(g => `
                <li class="goal-item ${g.completed ? 'completed' : ''}">
                    <div class="goal-text-wrapper">
                        <div class="goal-check ${g.completed ? 'checked' : ''}" onclick="handleToggle(${g.id}, ${g.completed}, '${type}')">
                            <i class="fa-solid fa-check"></i>
                        </div>
                        <span class="goal-text">${g.text}</span>
                    </div>
                    <button class="goal-delete" onclick="handleDelete(${g.id}, '${type}')">
                        <i class="fa-solid fa-trash-can"></i>
                    </button>
                </li>
            `).join('');
        }

        // --- LISTENERS ---
        document.getElementById('add-goal-btn').onclick = () => addGoal('goal-input', 'long-term');
        document.getElementById('add-daily-goal-btn').onclick = () => addGoal('daily-goal-input', 'daily');
        
        ['goal-input', 'daily-goal-input'].forEach(id => {
            document.getElementById(id).onkeypress = (e) => { if(e.key === 'Enter') addGoal(id, id.includes('daily') ? 'daily' : 'long-term'); };
        });

        // Init
        render('daily');
        render('long-term');
    </script>
</body>
</html>